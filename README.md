# MuranoTest
Проект разбит на 6 сборок:
1. SearchEngine.Web - основной проект web-приложения на базе ASP.NET Core MVC
2. SearchEngine.Models - содержит модели и интерфейсы, используемые остальными сборками. По сути это POCO-объекты.
В папке Database описаны объекты-сущности, используемые EF Core.
3. SearchEngine.DataAccess - описание класса, унаследованного от DbContext. В нем также описана стартовая инициализация данных,
которая может быть использована для генерации файлов миграции (dotnet ef migrations add InitialCreate), которые в свою очередь используются
для первоначального наката базы данных с помощью команды dotnet ef database update.
4. SearchEngine.Business - в ней сосредоточена бизнес-логика проекта.
5. SearchEngine.Resources - ресурсная сборка для хранения строчных литералов, используемых в коде.
6. SearchEngine.Tests - unit-тесты

Модель базы данных состоит из трех таблиц, которые находятся в разных схемах: Business (таблицы, относящиеся к бизнес-логике) и 
Dictionaries (таблицы, в которых находятся разного рода перечислимые сущности).
Dictionaries.SearchEngineType - описывает типы поисковиков, которые могут быть использованы в системе.
Business.Search - хранит запрос, время запроса, поисковик через который произошел запрос.
Business.SearchResult - отдельный результат запроса, включающий описание и URL-адреса.

Для взаимодействия с хранилищем данных описан интерфейс IRepository, и реализован конкретный экземпляр SQLSearchRepository.
Это сделано для абстракции от конкретной реализации работы с хранилищем и дает возможность гибко переключится на другой тип хранилища.

Я не стал усложнять модель данных SearchResult и оставил только описание и URL-адрес, т.к. это по сути основная информация, которая
интересует пользователя при запросе. Вдобавок все поисковики однозначно возвращают эту информацию и поэтому она будет хранится в 
унифицированном виде.

Движки поисковиков находятся в папке Engines проекта Business.
Основная логика получения данных сосредоточена на обращении к REST-сервисам поисковых служб. (К Bing запросы не будут проходить, т.к. я не смог
получить секретный ключ. Сервис выдает ошибку, то что сервисы Azure пока недоступны в России).
Для движков создан специальный базовый абстрактный класс BaseEngine.
В качестве основы был выбран абстрактный класс, т.к. все движки реализуют одинаковую последовательность шагов при поиске и они по своей
природе однородны.
Основной метод Execute представляет собой шаблонный метод (Template method). В нем описана последовательность шагов, которые должны
реализовать и выполнить конкретные движки:
1. PrepareRequest - подготовка запроса
2. ExecuteRequest - выполнение запроса
3. ParseResponse - синтаксический анализ полученного ответа и его материализация в конкретный объект ответа, реализующего интерфейс IResponse

Каждый из движков может воспользоваться реализациями методов базового класса, кроме ParseResponse.
Если движок реализует какую-то свою логику при подготовке запроса (например, как это делает BingEngine, которому в header запроса надо
передавать секретный ключ), то он может переопределить или расширить поведение методов базового класса.

Все движки материализуются в коде в виде DI-контейнеров.
Настройки движков описаны в appsettings.json. Настройки также имеют свои обертки и материализуются в виде DI-контейнеров по месту требования.
В настройках я вынес в отдельное поле Value, которое хранит секретную часть, для того чтобы удобно было редактировать и изменять, нежели
если это делать в строке запроса RequestFormat.

Таким образом, если потребуется добавить новый движок поиска, то достаточно выполнить следующие шаги:
1. Добавить новое значение в таблицу Dictionaries.SearchEngineType
2. Реализовать класс ответа, унаследовав его от класса Response. В нем описать структуру данных, которая необходима для десериализации 
ответа от поисковой службы. В данном случае Google и Bing десериализуются из формата JSON, Yandex - из XML.
3. Реализовать класс движка, унаследовав от абстрактного класса BaseEngine и по необходимости расширить логику.
4. Добавить класс с описанием настроек.
5. Зарегистрировать настройки и класс движка в виде DI в классе Startup.

Также опубликовал образ Docker ASP.NET приложения  на Docker Hub с идентификатором maximokulin/searchengine (https://hub.docker.com/repository/docker/maximokulin/searchengine)
Но вероятно, он не сможет подняться в вашем докере, т.к. я не сделал возможность настройки ConnectionString базы данных через отдельный файл appsettings.docker.json

Для проверки работоспособности залил этот образ в свой докер, который находится в Ubuntu. Также приложение использует в контейнере MS SQL Server 2019.
Приложение доступно по адресу: http://murano.eta24.ru/

